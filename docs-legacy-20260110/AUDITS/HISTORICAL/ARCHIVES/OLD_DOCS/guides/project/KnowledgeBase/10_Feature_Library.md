# Feature: Library

**Directory**: `src/features/library`

The Library feature is the core browsing experience of the application.

## Components

### `PhotoGrid` (`components/PhotoGrid.tsx`)
This is the primary view. It uses **Masonry Layout** and **Virtualization**.

**Masonry Logic**:
Instead of CSS Grid (which enforces strict rows), the component manually calculates columns.
1.  Creates `N` empty arrays (columns).
2.  Iterates through `items`.
3.  Pushes each item into a column based on index (or height balancing logic).
4.  Result: `PortfolioItem[][]`.

**Virtualization**:
Uses `@tanstack/react-virtual`'s `useVirtualizer`.
-   **Scroll Element**: The main container div.
-   **Estimate Size**: Calculates height based on aspect ratio `(columnWidth / aspectRatio)`.
-   **Overscan**: Renders 5 screens worth of content above/below to prevent blank spaces during fast scrolling.

### `ViewRenderer` (`components/ViewRenderer.tsx`)
A switch component that decides which view to render based on `viewMode`:
-   `ViewMode.GRID` -> `PhotoGrid`
-   `ViewMode.CAROUSEL` -> `PhotoCarousel` / `CinematicCarousel`
-   `ViewMode.LIST` -> `PhotoList` (Table view with columns for name, date, size, tags)

### `CinematicCarousel` (`components/CinematicCarousel.tsx`)
An experimental 3D carousel using `framer-motion`.
-   **Effect**: Items float in 3D space. Center item is large, side items fade back and blur.
-   **Navigation**: Arrow keys to rotate the carousel.

### `PhotoCard` (`components/PhotoCard.tsx`)
The atomic unit of the grid.
-   **Memoization**: Strongly memoized with a custom comparison function. It *only* re-renders if:
    -   Its own `item` data changes.
    -   Its `isSelected` status changes.
    -   Its `isFocused` status changes.
    -   It *ignores* global state changes that don't affect it.
-   **Interactions**:
    -   `onClick`: Select (or open if double click).
    -   `onContextMenu`: Opens native context menu.
    -   Draggable: Initiates drag operations for moving to folders.

## Logic

**Sorting & Filtering**:
Handled in `LibraryContext`, not the UI components. The components receive an already `processedItems` array. This separation ensures the UI logic stays purely about rendering.

**Asset Loading**:
Images use `loading="lazy"` and `decoding="async"`. The `src` attribute is a `asset://` URL generated by Tauri.
